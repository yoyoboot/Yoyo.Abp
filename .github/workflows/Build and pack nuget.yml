
name: Build and pack nuget
on:
  push:
    branches:
      - main
    tags:
      - '*' # 触发所有tag
jobs:
    build:
        runs-on: windows-latest
    
        steps:
        - uses: actions/checkout@v4
        - name: Setup dotnet
          uses: actions/setup-dotnet@v3
          with:
            dotnet-version: 6.0.x    
        - name: Cache NuGet packages
          uses: actions/cache@v3
          with:
           path: ~/.nuget/packages
           key: ${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj') }}
           restore-keys: |
            ${{ runner.os }}-build-nuget-${{ env.CACHE_NAME }}-
        - name: Restore dependencies
          run: dotnet restore
        - name: Build with dotnet
          run: dotnet build --configuration Release    
        - name: Pack with powershell
          shell: pwsh
          working-directory: ./nupkg
          run: ./pack.ps1

        

